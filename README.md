
# DeliveryHub

(Для демонстрации возможностей системы создан пример на основе заказа и доставки цветов - FlowerDelivery.)

## Описание проекта

**DeliveryHub** — это универсальная система, состоящая из двух независимых частей:

1. **Веб-сайт на Django** для оформления заказов и управления доставкой.
2. **Telegram-бот на aiogram** для управления заказами и интерактивного взаимодействия с пользователями.

Обе части используют общую базу данных SQLite (возможно использовать PostgreSQL или другую) для хранения данных о заказах, пользователях и товарах.

## Функциональность

### Веб-сайт (Django):

### Пользовательская часть:

- Просмотр каталога цветов.
- Регистрация и авторизация.
- Добавление товаров в корзину.
- Оформление заказов с указанием данных для доставки.
- Просмотр истории заказов.
- Оставление отзывов и оценок для товаров.

### Административная часть:

- Управление товарами, заказами и пользователями через Django Admin.
- Просмотр статистики и аналитики заказов.
- Дополнительная функция экспорта данных заказов в файл orders.csv для просмотра 
  статистики и аналитики в сторонних приложениях.
### Доступ к административной панели

   Административная панель доступна по адресу `http://<ваш_локальный_сервер>:8000/admin/`. В локальной среде разработки это обычно `http://127.0.0.1:8000/admin/`.


### Telegram-бот (aiogram):

### Основные возможности:

- Регистрация и авторизация пользователей.
- Управление корзиной: добавление и удаление товаров.
- Просмотр текущих заказов и их статусов.
- Интерактивные inline-клавиатуры для простого взаимодействия.
- Уведомления о статусе заказов.

### Административные функции:

- Просмотр и управление заказами через интерфейс бота.
- Уведомления об изменении статуса заказа.

## Установка и настройка

### 1. Клонирование репозитория

```bash
git clone https://github.com/your-repo/FlowerDelivery.git
cd FlowerDelivery
```

### 2. Установка зависимостей

Для установки всех зависимостей выполните:

```bash
pip install -r requirements.txt
```

### 3. Настройка переменных окружения

Создайте файл `.env` в директориях:

- `shop_project`
- `tg_bot`

Пример содержимого `shop_project/.env`:

```env
DJANGO_SECRET_KEY=your-secret-key
DJANGO_DEBUG=True
DJANGO_ALLOWED_HOSTS=127.0.0.1, .localhost
```

Пример содержимого `tg_bot/.env`:

```env
BOT_TOKEN=your-telegram-bot-token
DATABASE_PATH=./db.sqlite3
ADMIN_TELEGRAM_ID=your-admin-telegram-id
```

### 4. Миграции базы данных

Примените миграции для базы данных из директории `shop_project`:

```bash
python manage.py makemigrations
python manage.py migrate
```

### 5. Создание суперпользователя

После применения миграций создайте суперпользователя для доступа к административной панели Django:

```bash
python manage.py createsuperuser
```

В процессе выполнения команды введите логин, email и пароль.

### 6. Запуск сервера

Запустите Django-сервер разработки из директории `shop_project`:

```bash
python manage.py runserver
```

После запуска сервера админ-панель будет доступна по адресу:

```
http://127.0.0.1:8000/admin/
```

Войдите, используя учетные данные суперпользователя.


### Тестирование

Запуск тестов выполняйте из директории `shop_project`:

```bash
python manage.py test
```

### 6. Запуск Telegram-бота
Предварительно добавьте в меню бота команды `/start` и `/exit` через BotFather

Выполните из корневой директории проекта:

```bash
python -m tg_bot.bot
```

### Тестирование

Запуск тестов выполняйте
из корневой директории проекта:

```bash
pytest tg_bot/tests/
```

### 7.Скрипты для запуска проекта и тестов
В этом проекте предусмотрены два удобных скрипта для запуска сервера и тестов: `run.py` и `run_tests.py`.

### 1. Скрипт `run.py`

Скрипт `run.py` позволяет одновременно запустить Django-сервер и Telegram-бота.

#### Как использовать:

1. Убедитесь, что виртуальное окружение активировано:
   ```bash
   .venv\Scripts\activate
   ```
2. Выполните команду:
   ```bash
   python run.py
   ```

#### Что делает скрипт:

- Запускает Django-сервер на стандартном порте (127.0.0.1:8000).
- Запускает Telegram-бота с модульным импортом.

#### Вывод:

При успешном запуске вы увидите сообщения:
```
Django сервер запущен.
Telegram-бот запущен.
```

### 2. Скрипт `run_tests.py`

Скрипт `run_tests.py` запускает тесты Django-проекта и Telegram-бота одновременно.

#### Как использовать:

1. Убедитесь, что виртуальное окружение активировано:
   ```bash
   .venv\Scripts\activate
   ```
2. Выполните команду:
   ```bash
   python run_tests.py
   ```

#### Что делает скрипт:

- Выполняет тесты Django-проекта с использованием команды `python manage.py test`.
- Запускает тесты Telegram-бота через `pytest`, с поиском тестов в директории `tg_bot/tests`.

#### Вывод:

После успешного выполнения тестов вы увидите результат в виде пройденных тестов.

##### Пример успешного выполнения:
```
Ran 13 tests in 3.211s

OK
===================================================== 20 passed in 1.38s ======================================================
```

## Требования

- Активированное виртуальное окружение.
- Установленные зависимости из `requirements.txt`.

## Используемые технологии

- **Django** — веб-фреймворк для создания сайта.
- **Django Admin** — для управления.
- **django-widget-tweaks** — для удобной настройки форм.
- **django-csp** — для улучшения безопасности.
- **aiogram** — библиотека для разработки Telegram-ботов.
- **SQLite** — база данных.
- **pytest** — для тестирования.
- **pandas** — для аналитики и обработки данных.

## Файловая структура проекта

```
FlowerDelivery/
|-- shop_project/           # Django-проект
|   |-- flower_shop/        # Главный модуль Django
|   |-- delivery/           # Приложение для обработки заказов
|   |-- analytics/          # Модуль аналитики
|   |-- users/              # Приложение для пользователей
|   |-- templates/          # Шаблоны HTML
|   |-- static/             # Статические файлы (CSS, JS, изображения)
|   |-- media/              # Медиа-файлы (загруженные пользователями)
|   |-- .env                # Файл переменных окружения
|   |-- manage.py           # Главный управляющий файл Django
|
|-- tg_bot/                 # Telegram-бот
|   |-- bot.py              # Основной файл бота
|   |-- handlers/           # Обработчики событий
|   |-- keyboards/          # Inline клавиатуры
|   |-- services/           # Логика работы с данными
|   |-- tests/              # Тесты для бота
|   |-- .env                # Файл переменных окружения
|
|-- db.sqlite3              # Общая база данных
|-- requirements.txt        # Список зависимостей проекта
```




 
